<app-loading-overlay
  [isLoading]="isLoading"
  message="載入中…"
></app-loading-overlay>

<div *ngIf="!isLoading" style="padding: 20px">
  <div style="margin-bottom: 1.8rem">
    <app-camp-search-card [campSearch]="campSearch" (back)="goBack()">
    </app-camp-search-card>
  </div>
  <div class="camp-list">
    <div *ngFor="let group of campDistData">
      <h2 class="district-title">{{ group.district }}</h2>
      <h3 class="camp-title">露營天氣情況</h3>

      <table border="1" cellpadding="5">
        <thead>
          <tr>
            <th>時間 / 日期</th>
            <th
              *ngFor="
                let kv of getWeatherByDistrictGrouped(group.district) | keyvalue
              "
            >
              {{ kv.key }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let idx of [].constructor(
                getMaxSlots(getWeatherByDistrictGrouped(group.district))
              );
              let i = index
            "
          >
            <td>
              {{ i === 0 ? "上午" : "下午" }}<br />
              {{ i === 0 ? "(00:00 ~ 12:00)" : "(13:00 ~ 23:00)" }}
            </td>
            <td
              *ngFor="
                let kv of getWeatherByDistrictGrouped(group.district) | keyvalue
              "
            >
              <ng-container
                *ngIf="kv.value[i] && kv.value[i].maxTemp !== '-'; else noData"
              >
                <!-- <div>{{ kv.value[i].timeRange }}</div> -->
                <div>
                  {{ kv.value[i].maxTemp }}°C ~ {{ kv.value[i].minTemp }}°C
                </div>
                <div>{{ kv.value[i].weather }}</div>
              </ng-container>

              <ng-template #noData>
                <div class="no-data">無資料</div>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
      <h3 class="camp-title">露營場列表</h3>
      <table class="camp-table">
        <thead>
          <tr>
            <th class="col-name">露營場名稱</th>
            <th class="col-city">縣市</th>
            <th class="col-address">地址</th>
            <th class="col-phone">電話</th>
            <th class="col-status">營業狀態</th>
            <th class="col-website">網站</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let site of group.data">
            <td class="col-name">{{ site.name }}</td>
            <td class="col-city">{{ site.city }}</td>
            <td class="col-address" [title]="site.address">
              <span class="text">{{ site.address || "-" }}</span>
            </td>
            <td class="col-phone">{{ site.phone || site.mobile || "-" }}</td>
            <td class="col-status">{{ site.status || "-" }}</td>
            <td class="col-website">
              <a
                *ngIf="site.website"
                [href]="site.website"
                target="_blank"
                class="btn-link"
                >前往</a
              >
              <span *ngIf="!site.website">
                <a
                  [href]="
                    'https://www.google.com/search?q=' + encodeURL(site.name)
                  "
                  target="_blank"
                  class="btn-link"
                >
                  前往
                </a>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
